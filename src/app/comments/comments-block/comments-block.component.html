<div class="comments-block">
    <div *ngIf="(comments$ | async)?.length" class="comments-stats">
        <p>{{totalComments}} коментар</p>
    </div>
    <div class="buttons">
        <ion-button fill="clear">
            <ion-icon name="thumbs-up-outline" slot="start"></ion-icon>
            Подобається
        </ion-button>
        <ion-button fill="clear" [id]="modalId">
            <ion-icon name="chatbubble-outline" slot="start"></ion-icon>
            Коментувати
        </ion-button>
    </div>
</div>

<ion-modal [trigger]="modalId" [initialBreakpoint]="0.8" (ionModalDidPresent)="onModalPresented()">
    <ng-template>

        <ion-content class="ion-padding">
            <div class="comments-modal-content-container">
                <div class="existing-comments">
                    <ng-container *ngIf="(comments$ | async)?.length; else noComments">
                        <ng-container *ngFor="let comment of (comments$ | async)">
                            <app-comment [comment]="comment" (replyToClicked)="onReplyTo($event)" [class.fadeout]="replyTo && comment.id !== replyTo"></app-comment>
                            <ng-container *ngIf="!!comment.children?.length">
                                <ng-container *ngFor="let childComment of comment.children">
                                    <app-comment [comment]="childComment" (replyToClicked)="onReplyTo($event)" [class.fadeout]="replyTo && childComment.id !== replyTo"></app-comment>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
                <ion-item class="comment-input" slot="fixed">
                    <ion-label *ngIf="replyTo" position="stacked"><ion-button size="small" fill="clear" (click)="cancelReplyTo()">Скасувати</ion-button></ion-label>
                    <ion-textarea #textarea type="text" [placeholder]="replyTo? 'Напишіть відповідь...' : 'Напишіть коментар...'"
                        [(ngModel)]="text"></ion-textarea>
                    <ion-button size="default" fill="clear" (click)="saveComment()" [disabled]="text.length < 5" slot="end" class="save-comment-btn"><ion-icon name="send-outline" slot="icon-only"></ion-icon></ion-button>
                </ion-item>
            </div>

        </ion-content>
    </ng-template>
</ion-modal>

<ng-template #noComments></ng-template>