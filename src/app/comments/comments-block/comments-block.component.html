<div class="comments-block" *ngIf="(comments$ | async)">
    <!-- <div *ngIf="(comments$ | async)?.length" class="comments-stats">
        <p>{{totalComments}} коментар</p>
    </div> -->
    <div class="buttons" [id]="modalId" (click)="click()">
        <p class="comments-info">{{totalComments}} коментар</p>
        <!-- <ion-button fill="clear">
            <ion-icon name="thumbs-up-outline" slot="start"></ion-icon>
            Подобається
        </ion-button> -->
        <ion-button fill="clear">
            <ion-icon name="chatbubble-outline" slot="start"></ion-icon>
            Коментувати
        </ion-button>
    </div>
</div>

<ion-modal [trigger]="modalId" [initialBreakpoint]="0.8" (ionModalDidPresent)="onModalPresented()" [isOpen]="isModalOpen" (ionModalWillDismiss)="isModalOpen = false">
    <ng-template>

        <ion-content>
            <div class="comments-modal-content-container">
                <div class="existing-comments">
                    <ng-container *ngIf="(comments$ | async)?.length; else noComments">
                        <ng-container *ngFor="let comment of (comments$ | async)">
                            <app-comment appLongPress (press)="onLongPress(comment.id)" [comment]="comment" (onButtonClicked)="isReply(comment.id)? cancelReplyTo() : onReplyTo($event)" [class.fadeout]="!!replyTo && !isReply(comment.id)" [buttonText]="isReply(comment.id) ? 'Скасувати' : 'Відповісти'"></app-comment>
                            <ng-container *ngIf="!!comment.children?.length">
                                <ng-container *ngFor="let childComment of comment.children">
                                    <app-comment [comment]="childComment" (onButtonClicked)="isReply(childComment.id)? cancelReplyTo() : onReplyTo($event)" [class.fadeout]="!!replyTo && !isReply(childComment.id)" [buttonText]="isReply(childComment.id) ? 'Скасувати' : 'Відповісти'"></app-comment>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
                <ion-item class="comment-input" slot="fixed">
                    <ion-textarea #textarea type="text" [placeholder]="replyTo? 'Напишіть відповідь...' : 'Напишіть коментар...'"
                        [(ngModel)]="text"></ion-textarea>
                    <ion-button size="default" fill="clear" (click)="saveComment()" [disabled]="text.length < 5" slot="end" class="save-comment-btn"><ion-icon name="send-outline" slot="icon-only"></ion-icon></ion-button>
                </ion-item>
            </div>

        </ion-content>
    </ng-template>
</ion-modal>

<ng-template #noComments></ng-template>