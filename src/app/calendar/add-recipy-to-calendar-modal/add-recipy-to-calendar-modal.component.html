<ion-button [id]="'add-recipy-to-calendar'" class="trigger-btn">
  <ion-icon name="add-circle-outline"></ion-icon>
</ion-button>

<ion-modal [trigger]="'add-recipy-to-calendar'">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="cancel()"><ion-icon name="close-outline"></ion-icon></ion-button>
        </ion-buttons>
        <ion-title>
          <div class="recipy-selection-result">
            <div class="recipy-selection-section" (click)="changeCurrentView(AddRecipyToCalView.SelectRecipy)">
              <span>Рецепт:</span>
              <span>{{selectedRecipy?.name}}</span>
            </div>
            <div class="recipy-selection-section" (click)="changeCurrentView(AddRecipyToCalView.SelectDate)">
              <span>Час приготування:</span>
              <span>{{(selectedTime | date) || '-'}}</span>
            </div>
            <div class="recipy-selection-section" (click)="changeCurrentView(AddRecipyToCalView.SetAmount)">
              <span>Порцій:</span>
              <span>{{portions || '-'}}</span>
              <span>Розмір порції:</span>
              <span>{{portionSize || '-'}}</span>
            </div>
          </div>
        </ion-title>
        <ng-container *ngIf="currentView === AddRecipyToCalView.SelectRecipy">
          <ion-buttons slot="end">
            <app-filters [pageId]="'add-recipy-to-cal'"></app-filters>
          </ion-buttons>
        </ng-container>
      </ion-toolbar>
    </ion-header>

    <ion-content #scrollingContainer (ionScroll)="onscroll($event)" [scrollEvents]="true">
      <ng-container *ngIf="currentView === AddRecipyToCalView.SelectRecipy">
        <ion-list *ngIf="(recipies$ | async) as allRecipies">
          <ng-container *ngFor="let recipy of allRecipies; let index = index">
            <app-recipy-in-calendar-short-view *ngIf="index < numberOfRecipiesToDisplay" [recipy]="recipy"
              (recipyClicked)="onRecipyClicked(recipy)"></app-recipy-in-calendar-short-view>
          </ng-container>
          <ion-infinite-scroll *ngIf="numberOfRecipiesToDisplay <= recipies.length"
            (ionInfinite)="onIonInfinite($event)">
            <ion-infinite-scroll-content></ion-infinite-scroll-content>
          </ion-infinite-scroll>
        </ion-list>
        <ion-fab *ngIf="showGoTop" (click)="goTop()" slot="fixed" vertical="bottom" horizontal="end">
          <ion-fab-button>
            <ion-icon name="chevron-up-circle"></ion-icon>
          </ion-fab-button>
        </ion-fab>
      </ng-container>

      <ng-container *ngIf="currentView === AddRecipyToCalView.SelectDate">
        <app-recipy-in-calendar-select-date [initialValue]="selectedTime?.toISOString()" (valueChanged)="onDateChanged($event)"></app-recipy-in-calendar-select-date>
      </ng-container>

      <ng-container *ngIf="currentView === AddRecipyToCalView.SetAmount">
        <app-recipy-in-calendar-select-portions-and-amount (amountValueChanged)="onAmountSelected($event)" (portionsValueChanged)="onPortionsSelected($event)"></app-recipy-in-calendar-select-portions-and-amount>
      </ng-container>
    </ion-content>
  </ng-template>
</ion-modal>