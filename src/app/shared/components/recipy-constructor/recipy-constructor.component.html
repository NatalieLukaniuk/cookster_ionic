<ion-segment [value]="currentTab" (ionChange)="onTabChange($event)">
  <ion-segment-button *ngFor="let tab of tabs" [value]="tab.value">
    <ion-label>{{ tab.name }}</ion-label>
  </ion-segment-button>
</ion-segment>

<ng-container [ngSwitch]="currentTab">
  <ng-container *ngSwitchCase="tabs[0].value">
    <ion-item>
      <ion-label position="floating">Назва рецепту</ion-label>
      <ion-input [(ngModel)]="recipyName"></ion-input>
    </ion-item>
    <ion-item>
      <ion-label position="floating">Джерело рецепту</ion-label>
      <ion-input [(ngModel)]="recipySource"></ion-input>
    </ion-item>

    <ion-accordion-group>
      <ion-accordion value="first">
        <ion-item slot="header" color="tertiary">
          <ion-label>Виберіть складність</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-radio-group [(ngModel)]="complexity">
            <ion-item *ngFor="let unit of complexityOptions">
              <ion-label>{{ getComplexityOptionsText(unit) }}</ion-label>
              <ion-radio slot="end" [value]="unit"></ion-radio>
            </ion-item>
          </ion-radio-group>
        </div>
      </ion-accordion>
      <ion-accordion value="second">
        <ion-item
          slot="header"
          [color]="selectedTags.length ? 'tertiary' : 'light'"
        >
          <ion-label>Виберіть теги</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <ion-list>
            <ion-item *ngFor="let tag of tags" (click)="onTagClicked(tag)">
              <ion-label>{{ getTagsText(tag) }}</ion-label>
              <ion-icon
                *ngIf="selectedTags.includes(tag)"
                slot="end"
                name="checkmark-outline"
              ></ion-icon>
            </ion-item>
          </ion-list>
        </div>
      </ion-accordion>
    </ion-accordion-group>

    <ion-item>
      <ion-checkbox
        slot="start"
        [checked]="isSplitIntoGroups"
        (ionChange)="onSplitChange($event)"
      ></ion-checkbox>
      <ion-label>Розділити інгридієнти на групи</ion-label>
    </ion-item>
    <ion-item>
      <ion-checkbox
        slot="start"
        [checked]="isBaseRecipy"
        (ionChange)="onBaseChange($event)"
      ></ion-checkbox>
      <ion-label>Базовий рецепт</ion-label>
    </ion-item>
    <div>
      <app-image *ngIf="photo.length" [imagePath]="photo"></app-image>
      <app-file-upload
        *ngIf="!photo.length"
        (fileUploaded)="onFileUploaded($event)"
      ></app-file-upload>
    </div>
  </ng-container>

  <ng-container *ngSwitchCase="tabs[1].value">
    <ion-list>
      <ion-item
        swipeLeftNoConfirmation
        *ngFor="let ingredient of ingredients; let index = index"
        (itemSwiped)="onDeleteIngr(index)"
      >
        <ion-label class="ingredient-item-content">
          <span>{{ getIngredient(ingredient.product) }}</span>
          <app-add-group-modal
            *ngIf="isSplitIntoGroups && ingredient.group"
            [ingredindex]="index"
            [groups]="groups"
            [preselectedGroup]="ingredient.group"
            [textTitle]="ingredient.group"
            (onGroupSelected)="onGroupSelected($event, index)"
          ></app-add-group-modal>
          <app-add-group-modal
            *ngIf="isSplitIntoGroups && !ingredient.group"
            [ingredindex]="ingredients.length"
            [groups]="groups"
            (onGroupSelected)="onGroupSelected($event, index)"
          ></app-add-group-modal>
          <span
            >{{
              ingredient.amount
                | convertToSelectedUnit
                  : ingredient.product
                  : ingredient.defaultUnit
                | normalizeDisplayedAmount : ingredient.defaultUnit
            }}
            {{ getUnitText(ingredient.defaultUnit) }}</span
          >
        </ion-label>
      </ion-item>
    </ion-list>
    <ion-accordion-group>
      <ion-accordion value="first">
        <ion-item slot="header" color="light">
          <ion-label>Додати інгридієнт</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <app-add-ingredient
            [isSplitIntoGroups]="isSplitIntoGroups"
            [groups]="groups"
            (addNewIngredient)="onAddIngredient($event)"
          ></app-add-ingredient>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </ng-container>

  <ng-container *ngSwitchCase="tabs[2].value">
    <ion-list>
      <ion-reorder-group
        [disabled]="false"
        (ionItemReorder)="handleReorder($any($event))"
      >
        <ion-item
          class="step"
          *ngFor="let step of steps; let index = index"
          swipeLeftNoConfirmation
          (itemSwiped)="onDeleteStep(step)"
        >
          <ion-label class="ingredient-item-content">
            <span
              class="step-description"
              appLongPress
              (press)="onLongPress(index)"
              >{{ step.description }}</span
            >
            <span class="step-time"
              ><ion-icon name="american-football-outline"></ion-icon
              >{{ step.timeActive | normalizeTime }}
              <ion-icon name="beer-outline"></ion-icon
              >{{ step.timePassive | normalizeTime }}</span
            >
          </ion-label>
          <ion-reorder slot="end"></ion-reorder>
        </ion-item>
      </ion-reorder-group>
    </ion-list>
    <div *ngIf="editStepIndex !== null">
      <ion-list [inset]="true">
        <ion-list-header>Редагування</ion-list-header>
        <ion-item color="light">
          <ion-label position="floating" class="edit-input">Опис</ion-label>
          <ion-textarea
            placeholder="Type something here"
            [autoGrow]="true"
            [(ngModel)]="steps[editStepIndex].description"
          >
          </ion-textarea>
        </ion-item>
        <ion-item color="light">
          <ion-label position="floating">Активний час в хвилинах</ion-label>
          <ion-input
            type="tel"
            [(ngModel)]="steps[editStepIndex].timeActive"
          ></ion-input>
        </ion-item>
        <ion-item color="light">
          <ion-label position="floating">Пасивний час в хвилинах</ion-label>
          <ion-input
            type="tel"
            [(ngModel)]="steps[editStepIndex].timePassive"
          ></ion-input>
        </ion-item>
      </ion-list>

      <ion-button expand="full" (click)="saveStep()">Зберегти</ion-button>
    </div>
    <ion-accordion-group>
      <ion-accordion value="first">
        <ion-item slot="header" color="light">
          <ion-label>Додати крок</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <app-add-step (addNewStep)="onAddNewStep($event)"></app-add-step>
        </div>
      </ion-accordion>
    </ion-accordion-group>
  </ng-container>
</ng-container>

<ion-accordion-group>
  <ion-accordion value="first">
    <ion-item slot="header" color="light">
      <ion-label>Що ще не готово</ion-label>
    </ion-item>
    <div class="ion-padding" slot="content">
      <ion-list>
        <ion-list-header *ngIf="notReadyMandatory.length"
          >Обов'язково:</ion-list-header
        >
        <ion-item *ngFor="let item of notReadyMandatory">
          <ion-label>{{ item }}</ion-label>
        </ion-item>
      </ion-list>
      <ion-list>
        <ion-list-header *ngIf="notReadyOptional.length"
          >За бажанням:</ion-list-header
        >
        <ion-item *ngFor="let item of notReadyOptional">
          <ion-label>{{ item }}</ion-label>
        </ion-item>
      </ion-list>
    </div>
  </ion-accordion>
</ion-accordion-group>

<ion-button
  expand="full"
  (click)="recipyToPatch && isSavedDraft ? saveEditedDraft() : saveDraft()"
  >{{
    recipyToPatch && isSavedDraft ? "Оновити чернетку" : "Зберегти в чернетки"
  }}</ion-button
>
<ion-button
  *ngIf="isReadyToPublish"
  expand="full"
  (click)="recipyToPatch && isPublished ? updateRecipy() : saveNewRecipy()"
  >{{
    recipyToPatch && isPublished ? "Оновити рецепт" : "Опублікувати"
  }}</ion-button
>
